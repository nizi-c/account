# 实施计划

- [x] 1. 设置项目结构和核心接口





  - 创建目录结构：models, repositories, services, pages, components, utils
  - 定义核心数据模型接口（Transaction, Category, Achievement, Summary）
  - 定义枚举类型（TransactionType, MoodType, PeriodType）
  - 配置数据库表结构
  - _需求：1.1, 2.1, 7.1, 8.1_

- [ ]* 1.1 编写属性测试：数据模型验证
  - **属性 3: 输入验证的严格性**
  - **验证需求：1.4**

- [x] 2. 实现数据访问层





  - 实现RelationalStore数据库初始化
  - 实现TransactionRepository（create, delete, query, getAll, getByDateRange, getByCategory）
  - 实现CategoryRepository（getAll, getByType, getDefaultCategories）
  - 实现AchievementRepository（getAll, updateAchievement, getUnlocked）
  - _需求：1.1, 1.3, 2.1, 8.1, 11.1, 11.2_

- [ ]* 2.1 编写属性测试：交易持久化往返一致性
  - **属性 1: 交易持久化往返一致性**
  - **验证需求：11.1, 11.2**

- [ ]* 2.2 编写属性测试：删除操作的完整性
  - **属性 2: 删除操作的完整性**
  - **验证需求：1.3, 1.5**

- [ ]* 2.3 编写单元测试：Repository基础操作
  - 测试创建交易的所有字段正确保存
  - 测试删除不存在的交易返回适当错误
  - 测试查询空结果返回空数组
  - _需求：1.1, 1.3, 11.1_

- [x] 3. 实现业务逻辑层 - TransactionService





  - 实现addTransaction方法（包含输入验证）
  - 实现deleteTransaction方法
  - 实现searchTransactions方法（支持多条件查询）
  - 实现getDailySummary方法
  - 实现getMonthlySummary方法
  - 实现getWeeklySummary方法
  - 实现getYearlySummary方法
  - _需求：1.1, 1.3, 1.4, 3.1, 3.2, 3.3, 3.4, 4.1, 4.2, 4.3, 5.1-5.5_

- [ ]* 3.1 编写属性测试：日期范围查询的准确性
  - **属性 4: 日期范围查询的准确性**
  - **验证需求：3.1, 3.3, 5.3**

- [ ]* 3.2 编写属性测试：汇总计算的正确性
  - **属性 5: 汇总计算的正确性**
  - **验证需求：3.2, 3.4, 4.1, 4.2, 4.3**

- [ ]* 3.3 编写属性测试：金额范围查询的边界正确性
  - **属性 10: 金额范围查询的边界正确性**
  - **验证需求：5.1**

- [ ]* 3.4 编写属性测试：关键词搜索的包含性
  - **属性 11: 关键词搜索的包含性**
  - **验证需求：5.2**

- [ ]* 3.5 编写属性测试：分类过滤的精确性
  - **属性 12: 分类过滤的精确性**
  - **验证需求：5.4**

- [ ]* 3.6 编写属性测试：复合查询的交集正确性
  - **属性 13: 复合查询的交集正确性**
  - **验证需求：5.5**

- [x] 4. 实现业务逻辑层 - CategoryService





  - 实现getIncomeCategories方法
  - 实现getExpenseCategories方法
  - 实现预定义分类数据（餐饮、交通、购物、娱乐、工资、奖金等）
  - _需求：2.1, 2.2, 2.3_

- [ ]* 4.1 编写属性测试：分类过滤的类型一致性
  - **属性 8: 分类过滤的类型一致性**
  - **验证需求：2.2, 2.3**

- [ ]* 4.2 编写属性测试：分类汇总的准确性
  - **属性 9: 分类汇总的准确性**
  - **验证需求：2.4**

- [x] 5. 实现业务逻辑层 - StatisticsService





  - 实现generatePieChartData方法（支出分类占比）
  - 实现generateLineChartData方法（收支趋势）
  - 实现calculateCategoryPercentage方法
  - 实现generateMoodCalendar方法
  - _需求：4.5, 6.1, 6.2, 7.4_

- [ ]* 5.1 编写属性测试：分类占比计算的完整性
  - **属性 7: 分类占比计算的完整性**
  - **验证需求：4.5**

- [x] 6. 实现业务逻辑层 - AchievementService





  - 实现checkAchievements方法
  - 实现checkConsecutiveDays方法（连续记账7天）
  - 实现checkBudgetControl方法（月度预算控制）
  - 实现checkReasonableSpending方法（餐饮消费合理化）
  - 实现getAchievementProgress方法
  - _需求：8.1, 8.2, 8.3, 8.4, 8.5_

- [ ]* 6.1 编写属性测试：连续记账成就的解锁条件
  - **属性 16: 连续记账成就的解锁条件**
  - **验证需求：8.1**

- [ ]* 6.2 编写属性测试：预算控制成就的解锁条件
  - **属性 17: 预算控制成就的解锁条件**
  - **验证需求：8.2**

- [ ]* 6.3 编写属性测试：餐饮消费成就的解锁条件
  - **属性 18: 餐饮消费成就的解锁条件**
  - **验证需求：8.3**

- [x] 7. 实现工具类和辅助函数





  - 实现日期工具类（格式化、范围计算、周/月/年边界）
  - 实现数字格式化工具（货币、百分比）
  - 实现数据验证工具
  - 实现排序工具
  - _需求：1.4, 3.5, 4.1, 4.2, 4.3_

- [ ]* 7.1 编写属性测试：时间倒序排列的一致性
  - **属性 6: 时间倒序排列的一致性**
  - **验证需求：3.5**

- [x] 8. 实现首页（HomePage）





  - 创建首页布局（当日收支概览、快速添加按钮）
  - 实现当日交易列表显示
  - 实现当日收入/支出总额显示
  - 实现快速添加按钮导航
  - 实现下拉刷新功能
  - _需求：3.1, 3.2, 9.1_

- [ ]* 8.1 编写单元测试：首页组件渲染
  - 测试首页显示当日概览
  - 测试快速添加按钮存在
  - _需求：9.1_

- [x] 9. 实现添加交易页面（AddTransactionPage）





  - 创建交易输入表单（金额、用途、日期、分类、情绪）
  - 实现分类选择器（根据收入/支出类型动态显示）
  - 实现情绪选择器（满意😊、后悔😟、惊喜🎉）
  - 实现日期选择器
  - 实现表单验证和错误提示
  - 实现提交按钮和保存逻辑
  - _需求：1.1, 1.4, 2.1, 2.2, 2.3, 7.1, 7.2, 9.2_

- [ ]* 9.1 编写属性测试：情绪标签关联的持久性
  - **属性 14: 情绪标签关联的持久性**
  - **验证需求：7.2**

- [ ]* 9.2 编写单元测试：表单验证
  - 测试负数金额被拒绝
  - 测试零金额被拒绝
  - 测试无效日期被拒绝
  - 测试必填字段验证
  - _需求：1.4_

- [x] 10. 实现交易列表组件（TransactionList）





  - 创建交易卡片组件（TransactionCard）
  - 实现列表渲染（支持虚拟滚动）
  - 实现侧滑删除功能
  - 实现删除确认对话框
  - 实现空状态显示
  - 实现情绪图标显示
  - _需求：1.2, 1.3, 3.1, 3.3, 3.5, 5.6, 7.3_

- [x] 10.1 编写单元测试：侧滑删除交互






  - 测试侧滑手势显示删除选项
  - 测试确认删除后记录被移除
  - _需求：1.2, 1.3_

- [x] 11. 实现月视图页面（MonthViewPage）





  - 创建月视图布局
  - 实现月份选择器
  - 实现当月交易列表显示
  - 实现当月收入/支出总额显示
  - 实现月度汇总卡片
  - _需求：3.3, 3.4_

- [x] 12. 实现查询页面（QueryPage）





  - 创建查询表单布局
  - 实现金额范围输入（最小值、最大值）
  - 实现用途关键词搜索
  - 实现日期范围选择器
  - 实现分类多选
  - 实现查询按钮和重置按钮
  - 实现查询结果列表显示
  - 实现空结果提示
  - _需求：5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 9.3_

- [ ]* 12.1 编写单元测试：查询功能
  - 测试单条件查询
  - 测试多条件组合查询
  - 测试空结果显示
  - _需求：5.1-5.6_

- [x] 13. 实现统计页面（StatisticsPage）








  - 创建统计页面布局
  - 实现时间维度选择器（周/月/年）
  - 实现汇总卡片（收入、支出、净收支）
  - 实现分类占比列表
  - _需求：4.1, 4.2, 4.3, 4.5_

- [x] 14. 实现图表组件





  - 实现饼图组件（PieChart）- 使用Canvas绘制
  - 实现折线图组件（LineChart）- 使用Canvas绘制
  - 实现图表交互（点击扇区显示详情）
  - 实现图表图例和标签
  - 实现图表响应式尺寸调整
  - _需求：6.1, 6.2, 6.3, 6.5, 10.4_

- [ ]* 14.1 编写单元测试：图表渲染
  - 测试饼图数据正确渲染
  - 测试折线图数据正确渲染
  - 测试图表交互
  - _需求：6.1, 6.2, 6.3_

- [x] 15. 将图表集成到统计页面





  - 在统计页面添加饼图（支出分类占比）
  - 在统计页面添加折线图（收支趋势）
  - 实现图表与汇总数据的联动
  - _需求：6.1, 6.2_

- [x] 16. 实现情绪日历页面（MoodCalendarPage）




  - 创建日历布局
  - 实现月份导航
  - 实现日历单元格（显示日期和主要情绪图标）
  - 实现点击日期显示该日情绪交易列表
  - 实现情绪统计（每种情绪的数量）
  - _需求：7.4, 7.5_

- [ ]* 16.1 编写属性测试：情绪过滤的准确性
  - **属性 15: 情绪过滤的准确性**
  - **验证需求：7.5**

- [x] 17. 实现成就页面（AchievementPage）





  - 创建成就页面布局
  - 实现成就列表（已解锁和未解锁）
  - 实现成就徽章组件（AchievementBadge）
  - 实现成就进度条
  - 实现成就解锁动画和通知
  - _需求：8.4, 8.5_

- [x] 17.1 编写单元测试：成就显示




  - 测试成就列表包含所有成就
  - 测试已解锁成就正确显示
  - 测试成就进度正确计算
  - _需求：8.4, 8.5_

- [x] 18. 实现响应式布局





  - 实现屏幕尺寸检测工具
  - 为所有页面添加响应式布局逻辑
  - 实现手机模式（单列布局）
  - 实现平板模式（多列布局、侧边栏）
  - 实现图表响应式尺寸
  - 测试横屏和竖屏切换
  - _需求：10.1, 10.2, 10.4, 10.5_

- [ ]* 18.1 编写单元测试：响应式布局
  - 测试手机屏幕使用单列布局
  - 测试平板屏幕使用多列布局
  - 测试图表尺寸适配
  - _需求：10.1, 10.2, 10.4_

- [x] 19. 实现导航和路由





  - 配置页面路由（main_pages.json）
  - 实现底部导航栏（首页、统计、查询、成就）
  - 实现页面间导航逻辑
  - 实现返回按钮处理
  - _需求：9.1, 9.2, 9.3_

- [x] 20. 实现UI主题和样式





  - 定义全局颜色方案
  - 定义字体和排版规范
  - 实现一致的间距和圆角
  - 实现按钮样式（主要、次要、危险）
  - 实现卡片样式
  - 实现输入框样式
  - 优化视觉反馈（按压效果、加载状态）
  - _需求：9.4, 9.5, 9.6_

- [ ]* 20.1 编写单元测试：UI一致性
  - 测试配色方案一致性
  - 测试字体使用一致性
  - _需求：9.6_

- [ ] 21. 实现数据迁移机制
  - 实现数据库版本管理
  - 实现数据迁移逻辑（v1 -> v2）
  - 实现迁移错误处理
  - 测试旧版本数据兼容性
  - _需求：11.5_

- [ ]* 21.1 编写属性测试：数据迁移的向后兼容性
  - **属性 19: 数据迁移的向后兼容性**
  - **验证需求：11.5**

- [x] 22. 实现错误处理和用户反馈





  - 实现全局错误处理器
  - 实现Toast提示组件
  - 实现加载指示器组件
  - 实现错误页面
  - 实现数据保存失败处理
  - 实现数据加载失败处理和重试
  - _需求：11.3, 11.4_

- [ ]* 22.1 编写单元测试：错误处理
  - 测试保存失败显示错误提示
  - 测试加载失败提供重试选项
  - _需求：11.3, 11.4_

- [x] 23. 性能优化





  - 为数据库表添加索引（date, category, type）
  - 实现交易列表虚拟滚动
  - 实现汇总数据缓存
  - 优化图表渲染性能
  - 实现懒加载
  - _需求：3.1, 3.3, 4.1, 4.2, 4.3_

- [x] 24. 实现数据初始化和示例数据





  - 实现首次启动检测
  - 实现预定义分类初始化
  - 实现预定义成就初始化
  - （可选）实现示例交易数据生成
  - _需求：2.1, 8.5_

- [x] 25. 实现预算数据访问层





  - 创建Budget数据模型和枚举（BudgetType, BudgetStatus）
  - 实现BudgetRepository（create, update, delete, getMonthlyBudget, getWeeklyBudget, getCategoryBudgets, getAll）
  - 实现budgets数据库表初始化
  - _需求：12.1, 12.2, 12.3_

- [ ]* 25.1 编写属性测试：预算进度计算的准确性
  - **属性 20: 预算进度计算的准确性**
  - **验证需求：12.4, 12.7**

- [ ]* 25.2 编写属性测试：预算状态判断的正确性
  - **属性 21: 预算状态判断的正确性**
  - **验证需求：12.5, 12.6**

- [ ]* 25.3 编写单元测试：BudgetRepository操作
  - 测试创建预算
  - 测试更新预算
  - 测试查询预算
  - _需求：12.1, 12.2, 12.3_

- [x] 26. 实现预算业务逻辑层 - BudgetService





  - 实现setMonthlyBudget方法
  - 实现setWeeklyBudget方法
  - 实现setCategoryBudget方法
  - 实现getBudgetStatus方法
  - 实现updateBudgetProgress方法（根据交易自动更新）
  - 实现checkBudgetWarnings方法（检查80%预警和超支）
  - 实现getCurrentMonthlyBudget和getCurrentWeeklyBudget方法
  - 实现getCategoryBudgets方法
  - _需求：12.1, 12.2, 12.3, 12.4, 12.5, 12.6, 12.7, 12.8_

- [ ]* 26.1 编写属性测试：分类预算过滤的准确性
  - **属性 22: 分类预算过滤的准确性**
  - **验证需求：12.3, 12.8**

- [ ]* 26.2 编写单元测试：预算预警逻辑
  - 测试80%预警触发
  - 测试超支警告触发
  - 测试预算状态计算
  - _需求：12.5, 12.6_

- [x] 27. 实现预算管理页面（BudgetPage）





  - 创建预算页面布局
  - 实现月度预算设置表单
  - 实现周度预算设置表单
  - 实现分类预算设置表单
  - 实现预算进度条组件（BudgetProgressBar）
  - 实现预算卡片组件（BudgetCard）
  - 实现预警提示组件（WarningAlert）
  - 实现实时预算进度显示
  - 实现超支警告显示（标红）
  - _需求：12.1, 12.2, 12.3, 12.4, 12.5, 12.6, 12.8_

- [ ]* 27.1 编写单元测试：预算页面组件
  - 测试预算进度条显示
  - 测试预警提示显示
  - 测试超支警告显示
  - _需求：12.4, 12.5, 12.6_

- [x] 28. 集成预算功能到交易流程





  - 在添加交易后自动更新相关预算进度
  - 在删除交易后自动更新相关预算进度
  - 在首页显示当前预算状态概览
  - 实现预算预警通知
  - _需求：12.7_

- [x] 29. 实现数据导出功能 - ExportService





  - 实现exportToCSV方法（支持日期范围过滤）
  - 实现exportToJSON方法（支持日期范围过滤）
  - 实现generateCSVContent方法（包含表头：日期、类型、分类、金额、用途、情绪）
  - 实现generateFullBackup方法（包含交易、分类、成就、预算）
  - 实现saveExportFile方法（保存到用户可访问目录）
  - 实现导出错误处理和重试逻辑
  - _需求：13.1, 13.2, 13.3, 13.4, 13.5, 13.6, 13.7, 13.8_

- [ ]* 29.1 编写属性测试：CSV导出的完整性
  - **属性 23: CSV导出的完整性**
  - **验证需求：13.2, 13.6**

- [ ]* 29.2 编写属性测试：JSON导出的往返一致性
  - **属性 24: JSON导出的往返一致性**
  - **验证需求：13.3, 13.8**

- [ ]* 29.3 编写属性测试：日期范围导出的准确性
  - **属性 25: 日期范围导出的准确性**
  - **验证需求：13.5**

- [ ]* 29.4 编写单元测试：导出功能
  - 测试CSV格式正确性
  - 测试JSON格式正确性
  - 测试导出文件保存
  - 测试导出错误处理
  - _需求：13.2, 13.3, 13.4, 13.7_

- [x] 30. 实现数据导出页面（ExportPage）







  - 创建导出页面布局
  - 实现格式选择（CSV/JSON）
  - 实现日期范围选择器
  - 实现导出按钮
  - 实现导出进度指示器
  - 实现导出成功提示（显示文件路径）
  - 实现导出失败提示和重试按钮
  - _需求：13.1, 13.4, 13.5, 13.7_

- [ ]* 30.1 编写单元测试：导出页面
  - 测试格式选择功能
  - 测试日期范围选择
  - 测试导出成功提示
  - _需求：13.1, 13.4, 13.5_

- [x] 31. 更新导航添加新页面




  - 在导航栏添加预算管理入口
  - 在设置或更多页面添加数据导出入口
  - 实现页面路由配置
  - _需求：12.1, 13.1_

- [ ] 32. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户


- [x] 33. 集成测试和端到端测试



  - 测试完整用户流程：添加交易 → 查看列表 → 查询 → 删除
  - 测试成就解锁流程
  - 测试情绪记账流程
  - 测试预算管理流程：设置预算 → 添加交易 → 查看进度 → 预警提示
  - 测试数据导出流程：选择格式 → 导出 → 验证文件
  - 测试响应式布局切换
  - 测试数据持久化和恢复
  - _需求：1.1-13.8_

- [ ]* 33.1 编写集成测试
  - 测试添加交易到查看的完整流程
  - 测试查询和删除的完整流程
  - 测试成就解锁的完整流程
  - 测试预算管理的完整流程
  - 测试数据导出的完整流程
  - _需求：1.1, 1.3, 5.1-5.5, 8.1-8.3, 12.1-12.8, 13.1-13.8_

- [ ] 34. 无障碍性和国际化
  - 添加屏幕阅读器支持
  - 确保颜色对比度符合标准
  - 确保可触摸目标至少48dp
  - 实现中英文语言切换
  - 实现货币和日期格式本地化
  - _需求：9.4, 9.6_

- [ ] 35. 最终测试和优化
  - 执行完整的功能测试
  - 执行性能测试
  - 修复发现的bug
  - 优化用户体验
  - 准备发布版本
  - _需求：所有需求_
