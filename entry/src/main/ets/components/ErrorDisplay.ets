/**
 * Error Display Components
 * é”™è¯¯æ˜¾ç¤ºç»„ä»¶
 * 
 * æä¾›ç»Ÿä¸€çš„é”™è¯¯çŠ¶æ€æ˜¾ç¤ºå’Œé‡è¯•åŠŸèƒ½
 */

import { ThemeColors, ThemeSpacing, ThemeBorderRadius } from '../utils/ThemeConstants';
import { ButtonStyles } from '../utils/ButtonStyles';

/**
 * é”™è¯¯æ˜¾ç¤ºç»„ä»¶
 */
@Component
export struct ErrorDisplay {
  @Prop message: string = 'åŠ è½½å¤±è´¥';
  @Prop description?: string;
  @Prop showRetry?: boolean = true;
  onRetry?: () => void;

  build() {
    Column() {
      // é”™è¯¯å›¾æ ‡
      Text('âš ï¸')
        .fontSize(48)
        .margin({ bottom: ThemeSpacing.md })

      // é”™è¯¯æ¶ˆæ¯
      Text(this.message)
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .fontColor(ThemeColors.textPrimary)
        .textAlign(TextAlign.Center)

      // é”™è¯¯æè¿°
      if (this.description) {
        Text(this.description)
          .fontSize(14)
          .fontColor(ThemeColors.textSecondary)
          .textAlign(TextAlign.Center)
          .margin({ top: ThemeSpacing.sm })
          .maxLines(3)
          .textOverflow({ overflow: TextOverflow.Ellipsis })
      }

      // é‡è¯•æŒ‰é’®
      if (this.showRetry && this.onRetry) {
        Button('é‡è¯•')
          .fontSize(14)
          .fontColor(ThemeColors.onPrimary)
          .backgroundColor(ThemeColors.primary)
          .borderRadius(ThemeBorderRadius.full)
          .padding({ left: ThemeSpacing.xl, right: ThemeSpacing.xl, top: ThemeSpacing.sm, bottom: ThemeSpacing.sm })
          .margin({ top: ThemeSpacing.lg })
          .onClick(() => {
            if (this.onRetry) {
              this.onRetry();
            }
          })
      }
    }
    .width('100%')
    .padding(ThemeSpacing.xl)
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
  }
}

/**
 * ç©ºçŠ¶æ€æ˜¾ç¤ºç»„ä»¶
 */
@Component
export struct EmptyState {
  @Prop message: string = 'æš‚æ— æ•°æ®';
  @Prop description?: string;
  @Prop icon?: string = 'ðŸ“­';
  @Prop actionText?: string;
  onAction?: () => void;

  build() {
    Column() {
      // å›¾æ ‡
      Text(this.icon)
        .fontSize(64)
        .margin({ bottom: ThemeSpacing.md })

      // æ¶ˆæ¯
      Text(this.message)
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .fontColor(ThemeColors.textPrimary)
        .textAlign(TextAlign.Center)

      // æè¿°
      if (this.description) {
        Text(this.description)
          .fontSize(14)
          .fontColor(ThemeColors.textSecondary)
          .textAlign(TextAlign.Center)
          .margin({ top: ThemeSpacing.sm })
          .maxLines(3)
          .textOverflow({ overflow: TextOverflow.Ellipsis })
      }

      // æ“ä½œæŒ‰é’®
      if (this.actionText && this.onAction) {
        Button(this.actionText)
          .fontSize(14)
          .fontColor(ThemeColors.onPrimary)
          .backgroundColor(ThemeColors.primary)
          .borderRadius(ThemeBorderRadius.full)
          .padding({ left: ThemeSpacing.xl, right: ThemeSpacing.xl, top: ThemeSpacing.sm, bottom: ThemeSpacing.sm })
          .margin({ top: ThemeSpacing.lg })
          .onClick(() => {
            if (this.onAction) {
              this.onAction();
            }
          })
      }
    }
    .width('100%')
    .padding(ThemeSpacing.xl)
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
  }
}

/**
 * å†…è”é”™è¯¯æç¤ºç»„ä»¶
 */
@Component
export struct InlineError {
  @Prop message: string;
  @Prop showIcon?: boolean = true;

  build() {
    Row() {
      if (this.showIcon) {
        Text('âš ï¸')
          .fontSize(16)
          .margin({ right: ThemeSpacing.xs })
      }

      Text(this.message)
        .fontSize(14)
        .fontColor(ThemeColors.error)
        .layoutWeight(1)
    }
    .width('100%')
    .padding(ThemeSpacing.sm)
    .backgroundColor(ThemeColors.errorContainer)
    .borderRadius(ThemeBorderRadius.sm)
  }
}

/**
 * é”™è¯¯é¡µé¢ç»„ä»¶
 */
@Component
export struct ErrorPage {
  @Prop title: string = 'å‡ºé”™äº†';
  @Prop message: string = 'é¡µé¢åŠ è½½å¤±è´¥';
  @Prop errorCode?: string;
  @Prop showRetry?: boolean = true;
  @Prop showBack?: boolean = true;
  onRetry?: () => void;
  onBack?: () => void;

  build() {
    Column() {
      // é”™è¯¯å›¾æ ‡
      Text('ðŸ˜•')
        .fontSize(80)
        .margin({ bottom: ThemeSpacing.lg })

      // æ ‡é¢˜
      Text(this.title)
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
        .fontColor(ThemeColors.textPrimary)
        .textAlign(TextAlign.Center)
        .margin({ bottom: ThemeSpacing.sm })

      // é”™è¯¯æ¶ˆæ¯
      Text(this.message)
        .fontSize(16)
        .fontColor(ThemeColors.textSecondary)
        .textAlign(TextAlign.Center)
        .margin({ bottom: ThemeSpacing.md })
        .maxLines(5)
        .textOverflow({ overflow: TextOverflow.Ellipsis })

      // é”™è¯¯ä»£ç 
      if (this.errorCode) {
        Text(`é”™è¯¯ä»£ç : ${this.errorCode}`)
          .fontSize(12)
          .fontColor(ThemeColors.textTertiary)
          .textAlign(TextAlign.Center)
          .margin({ bottom: ThemeSpacing.lg })
      }

      // æ“ä½œæŒ‰é’®
      Row() {
        if (this.showBack && this.onBack) {
          Button('è¿”å›ž')
            .fontSize(14)
            .fontColor(ThemeColors.primary)
            .backgroundColor(ThemeColors.surface)
            .borderRadius(ThemeBorderRadius.full)
            .border({ width: 1, color: ThemeColors.outline })
            .padding({ left: ThemeSpacing.xl, right: ThemeSpacing.xl, top: ThemeSpacing.sm, bottom: ThemeSpacing.sm })
            .margin({ right: ThemeSpacing.md })
            .onClick(() => {
              if (this.onBack) {
                this.onBack();
              }
            })
        }

        if (this.showRetry && this.onRetry) {
          Button('é‡è¯•')
            .fontSize(14)
            .fontColor(ThemeColors.onPrimary)
            .backgroundColor(ThemeColors.primary)
            .borderRadius(ThemeBorderRadius.full)
            .padding({ left: ThemeSpacing.xl, right: ThemeSpacing.xl, top: ThemeSpacing.sm, bottom: ThemeSpacing.sm })
            .onClick(() => {
              if (this.onRetry) {
                this.onRetry();
              }
            })
        }
      }
      .justifyContent(FlexAlign.Center)
    }
    .width('100%')
    .height('100%')
    .padding(ThemeSpacing.xl)
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
    .backgroundColor(ThemeColors.background)
  }
}
