/**
 * Error Handling Demo Page
 * é”™è¯¯å¤„ç†æ¼”ç¤ºé¡µé¢
 * 
 * å±•ç¤ºæ‰€æœ‰é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆç»„ä»¶çš„ä½¿ç”¨æ–¹æ³•
 */

import { 
  ErrorDisplay, 
  EmptyState, 
  InlineError, 
  ErrorPage,
  LoadingIndicator,
  FullScreenLoading,
  InlineLoading,
  Toast
} from '../components';
import { ErrorHandler } from '../utils/ErrorHandler';
import { ThemeColors, ThemeSpacing } from '../utils/ThemeConstants';
import router from '@ohos.router';

@Entry
@Component
struct ErrorHandlingDemo {
  @State showErrorDisplay: boolean = false;
  @State showEmptyState: boolean = false;
  @State showInlineError: boolean = false;
  @State showErrorPage: boolean = false;
  @State showLoading: boolean = false;
  @State showFullScreenLoading: boolean = false;
  @State showInlineLoading: boolean = false;

  build() {
    Column() {
      // Header
      Row() {
        Button('è¿”å›ž')
          .fontSize(14)
          .onClick(() => {
            router.back();
          })
        
        Text('é”™è¯¯å¤„ç†æ¼”ç¤º')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .layoutWeight(1)
          .textAlign(TextAlign.Center)
        
        // Placeholder for alignment
        Button()
          .width(60)
          .visibility(Visibility.Hidden)
      }
      .width('100%')
      .padding(ThemeSpacing.MD)
      .backgroundColor(ThemeColors.BG_PRIMARY)

      Scroll() {
        Column({ space: ThemeSpacing.MD }) {
          // Toast Examples
          this.buildSection('Toast æç¤º')
          Column({ space: ThemeSpacing.SM }) {
            Button('æˆåŠŸæç¤º')
              .width('100%')
              .onClick(() => {
                Toast.success('æ“ä½œæˆåŠŸï¼');
              })

            Button('é”™è¯¯æç¤º')
              .width('100%')
              .onClick(() => {
                Toast.error('æ“ä½œå¤±è´¥ï¼');
              })

            Button('è­¦å‘Šæç¤º')
              .width('100%')
              .onClick(() => {
                Toast.warning('è¯·æ³¨æ„ï¼');
              })

            Button('ä¿¡æ¯æç¤º')
              .width('100%')
              .onClick(() => {
                Toast.info('è¿™æ˜¯ä¸€æ¡ä¿¡æ¯');
              })
          }
          this.buildSectionEnd()

          // Error Handler Examples
          this.buildSection('é”™è¯¯å¤„ç†å™¨')
          Column({ space: ThemeSpacing.SM }) {
            Button('éªŒè¯é”™è¯¯')
              .width('100%')
              .onClick(() => {
                ErrorHandler.handleValidationError('é‡‘é¢å¿…é¡»å¤§äºŽ0', 'amount');
              })

            Button('æ•°æ®åº“é”™è¯¯')
              .width('100%')
              .onClick(() => {
                const error = new Error('Connection failed');
                ErrorHandler.handleDatabaseError(error, 'save data');
              })

            Button('æ•°æ®ä¸ä¸€è‡´é”™è¯¯')
              .width('100%')
              .onClick(() => {
                ErrorHandler.handleDataInconsistencyError('æ•°æ®æ ¼å¼å¼‚å¸¸');
              })
          }
          this.buildSectionEnd()

          // Loading Indicators
          this.buildSection('åŠ è½½æŒ‡ç¤ºå™¨')
          Column({ space: ThemeSpacing.SM }) {
            Button(this.showLoading ? 'éšè—åŠ è½½' : 'æ˜¾ç¤ºåŠ è½½')
              .width('100%')
              .onClick(() => {
                this.showLoading = !this.showLoading;
              })

            if (this.showLoading) {
              LoadingIndicator({ message: 'åŠ è½½ä¸­...' })
                .height(100)
            }

            Button(this.showInlineLoading ? 'éšè—å†…è”åŠ è½½' : 'æ˜¾ç¤ºå†…è”åŠ è½½')
              .width('100%')
              .onClick(() => {
                this.showInlineLoading = !this.showInlineLoading;
              })

            if (this.showInlineLoading) {
              InlineLoading({ message: 'æ­£åœ¨å¤„ç†...' })
            }

            Button('æ˜¾ç¤ºå…¨å±åŠ è½½')
              .width('100%')
              .onClick(() => {
                this.showFullScreenLoading = true;
                setTimeout(() => {
                  this.showFullScreenLoading = false;
                }, 2000);
              })
          }
          this.buildSectionEnd()

          // Error Display Components
          this.buildSection('é”™è¯¯æ˜¾ç¤ºç»„ä»¶')
          Column({ space: ThemeSpacing.SM }) {
            Button(this.showErrorDisplay ? 'éšè—é”™è¯¯æ˜¾ç¤º' : 'æ˜¾ç¤ºé”™è¯¯æ˜¾ç¤º')
              .width('100%')
              .onClick(() => {
                this.showErrorDisplay = !this.showErrorDisplay;
              })

            if (this.showErrorDisplay) {
              ErrorDisplay({
                message: 'åŠ è½½å¤±è´¥',
                description: 'æ— æ³•è¿žæŽ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥',
                showRetry: true,
                onRetry: () => {
                  Toast.info('é‡è¯•ä¸­...');
                  this.showErrorDisplay = false;
                }
              })
                .height(200)
            }

            Button(this.showEmptyState ? 'éšè—ç©ºçŠ¶æ€' : 'æ˜¾ç¤ºç©ºçŠ¶æ€')
              .width('100%')
              .onClick(() => {
                this.showEmptyState = !this.showEmptyState;
              })

            if (this.showEmptyState) {
              EmptyState({
                message: 'æš‚æ— äº¤æ˜“è®°å½•',
                description: 'ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ ç¬¬ä¸€ç¬”äº¤æ˜“',
                icon: 'ðŸ“',
                actionText: 'æ·»åŠ äº¤æ˜“',
                onAction: () => {
                  Toast.info('è·³è½¬åˆ°æ·»åŠ é¡µé¢');
                }
              })
                .height(250)
            }

            Button(this.showInlineError ? 'éšè—å†…è”é”™è¯¯' : 'æ˜¾ç¤ºå†…è”é”™è¯¯')
              .width('100%')
              .onClick(() => {
                this.showInlineError = !this.showInlineError;
              })

            if (this.showInlineError) {
              InlineError({
                message: 'é‡‘é¢ä¸èƒ½ä¸ºç©ºæˆ–å°äºŽç­‰äºŽ0'
              })
            }

            Button('æ˜¾ç¤ºé”™è¯¯é¡µé¢')
              .width('100%')
              .onClick(() => {
                this.showErrorPage = true;
              })
          }
          this.buildSectionEnd()

          // Async Error Handling
          this.buildSection('å¼‚æ­¥é”™è¯¯å¤„ç†')
          Column({ space: ThemeSpacing.SM }) {
            Button('æµ‹è¯•å¼‚æ­¥åŒ…è£…')
              .width('100%')
              .onClick(async () => {
                const result = await ErrorHandler.wrapAsync<void>(
                  async () => {
                    // Simulate async operation
                    await new Promise<void>((resolve) => setTimeout(resolve, 1000));
                    throw new Error('æ¨¡æ‹Ÿé”™è¯¯');
                  },
                  'å¼‚æ­¥æ“ä½œå¤±è´¥'
                );
                
                if (result === null) {
                  Toast.info('æ“ä½œè¢«å–æ¶ˆ');
                }
              })

            Button('æµ‹è¯•åŒæ­¥åŒ…è£…')
              .width('100%')
              .onClick(() => {
                const result = ErrorHandler.wrapSync(
                  () => {
                    throw new Error('æ¨¡æ‹ŸåŒæ­¥é”™è¯¯');
                  },
                  'åŒæ­¥æ“ä½œå¤±è´¥'
                );
                
                if (result === null) {
                  Toast.info('æ“ä½œè¢«å–æ¶ˆ');
                }
              })
          }
          this.buildSectionEnd()
        }
        .width('100%')
        .padding(ThemeSpacing.MD)
      }
      .layoutWeight(1)

      // Full screen loading overlay
      if (this.showFullScreenLoading) {
        FullScreenLoading({ message: 'å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...' })
      }

      // Error page overlay
      if (this.showErrorPage) {
        ErrorPage({
          title: 'é¡µé¢åŠ è½½å¤±è´¥',
          message: 'æ— æ³•åŠ è½½é¡µé¢å†…å®¹ï¼Œè¯·ç¨åŽé‡è¯•',
          errorCode: 'ERR_500',
          showRetry: true,
          showBack: true,
          onRetry: () => {
            Toast.info('é‡æ–°åŠ è½½...');
            this.showErrorPage = false;
          },
          onBack: () => {
            this.showErrorPage = false;
          }
        })
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor(ThemeColors.BG_SECONDARY)
  }

  @Builder
  buildSection(title: string) {
    Column() {
      Text(title)
        .fontSize(16)
        .fontWeight(FontWeight.Bold)
        .fontColor(ThemeColors.TEXT_PRIMARY)
        .width('100%')
        .margin({ bottom: ThemeSpacing.SM })
    }
    .width('100%')
    .padding({ left: ThemeSpacing.MD, right: ThemeSpacing.MD, top: ThemeSpacing.MD })
    .backgroundColor(ThemeColors.BG_PRIMARY)
    .borderRadius({ topLeft: 8, topRight: 8 })
  }

  @Builder
  buildSectionEnd() {
    Column() {
    }
    .width('100%')
    .padding({ left: ThemeSpacing.MD, right: ThemeSpacing.MD, bottom: ThemeSpacing.MD })
    .backgroundColor(ThemeColors.BG_PRIMARY)
    .borderRadius({ bottomLeft: 8, bottomRight: 8 })
    .margin({ bottom: ThemeSpacing.MD })
  }
}
